{% extends "base_layout.html" %}

{% block title %}Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - Ù†Ø¸Ø§Ù… ERP{% endblock %}
{% block page_title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹{% endblock %}

{% block extra_css %}
<style>
    :root {
        --project-subscription: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --project-onetime: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        --project-completed: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        --project-cancelled: linear-gradient(135deg, #ed64a6 0%, #d53f8c 100%);
    }

    .project-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.8);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #1a202c;
        line-height: 1;
    }

    .stat-label {
        color: #64748b;
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    .project-card {
        background: white;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.8);
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .project-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }

    .project-type-badge {
        position: absolute;
        top: 1rem;
        left: 1rem;
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .type-subscription {
        background: var(--project-subscription);
    }

    .type-onetime {
        background: var(--project-onetime);
    }

    .project-header {
        padding: 1.5rem;
        border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        position: relative;
    }

    .project-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1a202c;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
    }

    .project-body {
        padding: 1.5rem;
    }

    .revenue-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .revenue-card {
        padding: 1rem;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        border-radius: 8px;
        border: 1px solid rgba(102, 126, 234, 0.1);
        text-align: center;
    }

    .revenue-label {
        font-size: 0.75rem;
        color: #64748b;
        margin-bottom: 0.25rem;
    }

    .revenue-amount {
        font-size: 1.1rem;
        font-weight: 700;
        color: #667eea;
    }

    .project-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        padding: 1rem 1.5rem;
        background: rgba(248, 250, 252, 0.5);
        border-top: 1px solid rgba(226, 232, 240, 0.5);
    }

    .btn-action {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
        border: none;
        transition: all 0.3s ease;
        cursor: pointer;
        color: white;
    }

    .btn-primary {
        background: var(--primary-gradient);
    }

    .btn-success {
        background: var(--project-onetime);
    }

    .btn-warning {
        background: var(--warning-gradient);
    }

    .btn-danger {
        background: var(--project-cancelled);
    }

    .filters-section {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.8);
    }

    .tech-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .tech-tag {
        padding: 0.25rem 0.75rem;
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .modal-content {
        border: none;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .form-control,
    .form-select {
        border-radius: 8px;
        border: 1px solid rgba(226, 232, 240, 0.8);
        transition: all 0.3s ease;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.15);
    }

    .clients-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid rgba(226, 232, 240, 0.8);
        border-radius: 8px;
        padding: 0.5rem;
    }

    .client-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.2s ease;
    }

    .client-item:hover {
        background: rgba(102, 126, 234, 0.05);
    }

    @media (max-width: 768px) {
        .project-stats {
            grid-template-columns: 1fr;
        }

        .revenue-info {
            grid-template-columns: 1fr;
        }

        .project-actions {
            flex-wrap: wrap;
        }

        .btn-action {
            flex: 1;
            min-width: 120px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="content-header">
    <div>
        <h1 class="page-title">
            <i class="fas fa-project-diagram me-2"></i>
            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
        </h1>
        <p class="page-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø¯ÙØ¹ Ø§Ù„ÙƒØ§Ù…Ù„</p>
    </div>
    <div class="content-actions">
        <button class="btn btn-modern btn-primary-modern" data-bs-toggle="modal" data-bs-target="#addProjectModal">
            <i class="fas fa-plus me-2"></i>
            Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
        </button>
    </div>
</div>

<!-- Statistics -->
<div class="project-stats">
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: var(--project-subscription);">
                <i class="fas fa-sync-alt"></i>
            </div>
            <div class="stat-number" id="subscriptionCount">12</div>
        </div>
        <div class="stat-label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: var(--project-onetime);">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-number" id="onetimeCount">8</div>
        </div>
        <div class="stat-label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙƒØ§Ù…Ù„</div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: var(--project-completed);">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-number" id="completedCount">15</div>
        </div>
        <div class="stat-label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙƒØªÙ…Ù„Ø©</div>
    </div>

    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-icon" style="background: var(--warning-gradient);">
                <i class="fas fa-coins"></i>
            </div>
            <div class="stat-number" id="monthlyRevenue">45,000</div>
        </div>
        <div class="stat-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Ø¬.Ù…)</div>
    </div>
</div>

<!-- Filters -->
<div class="filters-section">
    <div class="row align-items-end">
        <div class="col-lg-2 col-md-6 mb-3 mb-lg-0">
            <label class="form-label small text-muted fw-bold">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
            <select class="form-select" id="typeFilter">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                <option value="subscription">Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ</option>
                <option value="onetime">Ø¯ÙØ¹ ÙƒØ§Ù…Ù„</option>
            </select>
        </div>
        <div class="col-lg-2 col-md-6 mb-3 mb-lg-0">
            <label class="form-label small text-muted fw-bold">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select class="form-select" id="statusFilter">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                <option value="active">Ù†Ø´Ø·</option>
                <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                <option value="on-hold">Ù…Ø¹Ù„Ù‚</option>
                <option value="cancelled">Ù…Ù„ØºÙŠ</option>
            </select>
        </div>
        <div class="col-lg-2 col-md-6 mb-3 mb-lg-0">
            <label class="form-label small text-muted fw-bold">Ø§Ù„ØªÙ‚Ù†ÙŠØ©</label>
            <select class="form-select" id="techFilter">
                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª</option>
                <option value="React">React</option>
                <option value="Vue">Vue</option>
                <option value="Laravel">Laravel</option>
                <option value="Node.js">Node.js</option>
            </select>
        </div>
        <div class="col-lg-4 col-md-6 mb-3 mb-lg-0">
            <label class="form-label small text-muted fw-bold">Ø§Ù„Ø¨Ø­Ø«</label>
            <input type="text" class="form-control" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„...">
        </div>
        <div class="col-lg-2 col-md-12">
            <button class="btn btn-modern btn-primary-modern w-100" onclick="filterProjects()">
                <i class="fas fa-search me-2"></i>
                Ø¨Ø­Ø«
            </button>
        </div>
    </div>
</div>

<!-- Projects Grid -->
<div id="projectsGrid" class="row">
    <!-- Example Project Cards -->
    <div class="col-lg-6 col-xl-4 mb-4">
        <div class="project-card">
            <div class="project-header">
                <div class="project-type-badge type-subscription">Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ</div>
                <div class="project-title">Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</div>
                <div class="text-muted">Ù…Ù†ØµØ© Ø´Ø§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª</div>
            </div>
            <div class="project-body">
                <div class="revenue-info">
                    <div class="revenue-card">
                        <div class="revenue-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
                        <div class="revenue-amount">15,000 Ø¬.Ù…</div>
                    </div>
                    <div class="revenue-card">
                        <div class="revenue-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</div>
                        <div class="revenue-amount">25</div>
                    </div>
                </div>
                <div class="tech-stack">
                    <div class="fw-bold mb-2">Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                    <div class="tech-tags">
                        <span class="tech-tag">React</span>
                        <span class="tech-tag">Node.js</span>
                        <span class="tech-tag">MongoDB</span>
                    </div>
                </div>
            </div>
            <div class="project-actions">
                <button class="btn-action btn-primary">
                    <i class="fas fa-eye me-1"></i> Ø¹Ø±Ø¶
                </button>
                <button class="btn-action btn-success">
                    <i class="fas fa-users me-1"></i> Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†
                </button>
                <button class="btn-action btn-warning">
                    <i class="fas fa-edit me-1"></i> ØªØ¹Ø¯ÙŠÙ„
                </button>
            </div>
        </div>
    </div>

    <div class="col-lg-6 col-xl-4 mb-4">
        <div class="project-card">
            <div class="project-header">
                <div class="project-type-badge type-onetime">Ø¯ÙØ¹ ÙƒØ§Ù…Ù„</div>
                <div class="project-title">Ù…ÙˆÙ‚Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©</div>
                <div class="text-muted">Ù…ÙˆÙ‚Ø¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØªØ¹Ø±ÙŠÙÙŠ Ù„Ù„Ø´Ø±ÙƒØ© Ù…Ø¹ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø©</div>
            </div>
            <div class="project-body">
                <div class="revenue-info">
                    <div class="revenue-card">
                        <div class="revenue-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</div>
                        <div class="revenue-amount">35,000 Ø¬.Ù…</div>
                    </div>
                    <div class="revenue-card">
                        <div class="revenue-label">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                        <div class="revenue-amount">10,000 Ø¬.Ù…</div>
                    </div>
                </div>
                <div class="tech-stack">
                    <div class="fw-bold mb-2">Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                    <div class="tech-tags">
                        <span class="tech-tag">Laravel</span>
                        <span class="tech-tag">Vue.js</span>
                        <span class="tech-tag">MySQL</span>
                    </div>
                </div>
            </div>
            <div class="project-actions">
                <button class="btn-action btn-primary">
                    <i class="fas fa-eye me-1"></i> Ø¹Ø±Ø¶
                </button>
                <button class="btn-action btn-warning">
                    <i class="fas fa-edit me-1"></i> ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button class="btn-action btn-danger">
                    <i class="fas fa-trash me-1"></i> Ø­Ø°Ù
                </button>
            </div>
        </div>
    </div>

    <div class="col-lg-6 col-xl-4 mb-4">
        <div class="project-card">
            <div class="project-header">
                <div class="project-type-badge type-subscription">Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ</div>
                <div class="project-title">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
                <div class="text-muted">Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆØ§Ù„Ø¯ÙØ¹</div>
            </div>
            <div class="project-body">
                <div class="revenue-info">
                    <div class="revenue-card">
                        <div class="revenue-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
                        <div class="revenue-amount">8,500 Ø¬.Ù…</div>
                    </div>
                    <div class="revenue-card">
                        <div class="revenue-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</div>
                        <div class="revenue-amount">12</div>
                    </div>
                </div>
                <div class="tech-stack">
                    <div class="fw-bold mb-2">Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                    <div class="tech-tags">
                        <span class="tech-tag">React Native</span>
                        <span class="tech-tag">Django</span>
                        <span class="tech-tag">PostgreSQL</span>
                    </div>
                </div>
            </div>
            <div class="project-actions">
                <button class="btn-action btn-primary">
                    <i class="fas fa-eye me-1"></i> Ø¹Ø±Ø¶
                </button>
                <button class="btn-action btn-success">
                    <i class="fas fa-users me-1"></i> Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†
                </button>
                <button class="btn-action btn-warning">
                    <i class="fas fa-edit me-1"></i> ØªØ¹Ø¯ÙŠÙ„
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="text-center">
        <div class="mb-3">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„...</div>
        <h5>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h5>
    </div>
</div>

<!-- Project Details Modal -->
<div class="modal fade" id="projectDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="projectDetailsContent">
                    <!-- Project details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                <button type="button" class="btn btn-primary" id="editProjectBtn">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Project Modal -->
<div class="modal fade" id="editProjectModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editProjectForm">
                    <input type="hidden" id="editProjectId">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">ğŸ“ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label>
                                <input type="text" class="form-control" id="editProjectName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label>
                                <select class="form-control" id="editProjectStatus" required>
                                    <option value="active">ğŸŸ¢ Ù†Ø´Ø·</option>
                                    <option value="completed">âœ… Ù…ÙƒØªÙ…Ù„</option>
                                    <option value="on-hold">â¸ï¸ Ù…Ø¹Ù„Ù‚</option>
                                    <option value="cancelled">âŒ Ù…Ù„ØºÙŠ</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ğŸ“„ ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                        <textarea class="form-control" id="editDescription" rows="3"></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                                <input type="date" class="form-control" id="editStartDate">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                                <input type="date" class="form-control" id="editEndDate">
                            </div>
                        </div>
                    </div>

                    <!-- Financial fields will be added dynamically based on project type -->
                    <div id="editFinancialSection"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-warning" onclick="updateProject()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            </div>
        </div>
    </div>
</div>

<!-- Subscribers Modal -->
<div class="modal fade" id="subscribersModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</h6>
                    <button class="btn btn-success btn-sm" onclick="addSubscriber()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ</button>
                </div>
                <div id="subscribersContent">
                    <!-- Subscribers will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Subscriber Modal -->
<div class="modal fade" id="addSubscriberModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ Ø¬Ø¯ÙŠØ¯</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addSubscriberForm">
                    <input type="hidden" id="subscriberProjectId">
                    <div class="mb-3">
                        <label class="form-label">ğŸ‘¤ Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label>
                        <select class="form-control" id="subscriberClientId" required>
                            <option value="">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ğŸ“… ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                        <input type="date" class="form-control" id="subscriptionStartDate">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-primary" onclick="saveSubscriber()">ğŸ’¾ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´ØªØ±Ùƒ</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Project Modal -->
<div class="modal fade" id="addProjectModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header" style="background: var(--primary-gradient); color: white;">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>
                    Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <form id="addProjectForm">
                    <!-- Basic Information -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="fw-bold text-primary mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                            <input type="text" class="form-control" id="projectName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                            <select class="form-select" id="projectType" required onchange="toggleProjectType()">
                                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</option>
                                <option value="subscription">Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ</option>
                                <option value="onetime">Ø¯ÙØ¹ ÙƒØ§Ù…Ù„</option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-12">
                            <label class="form-label fw-bold">ÙˆØµÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                            <textarea class="form-control" id="description" rows="3"
                                placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹..."></textarea>
                        </div>
                    </div>

                    <!-- Financial Information -->
                    <div class="row mb-4" id="financialSection">
                        <div class="col-12">
                            <h6 class="fw-bold text-primary mb-3">
                                <i class="fas fa-dollar-sign me-2"></i>
                                Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                            </h6>
                        </div>

                        <!-- For subscription projects -->
                        <div id="subscriptionFinancial" style="display: none;">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                                <input type="number" class="form-control" id="monthlyPrice" step="0.01">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ</label>
                                <input type="number" class="form-control" id="subscriberCount" min="1" value="1">
                            </div>
                        </div>

                        <!-- For one-time projects -->
                        <div id="onetimeFinancial" style="display: none;">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</label>
                                <input type="number" class="form-control" id="totalAmount" step="0.01">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù‚Ø¯Ù…Ø§Ù‹</label>
                                <input type="number" class="form-control" id="paidAmount" step="0.01" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Technical Details -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="fw-bold text-primary mb-3">
                                <i class="fas fa-code me-2"></i>
                                Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ©
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</label>
                            <input type="text" class="form-control" id="technologies"
                                placeholder="React, Node.js, MongoDB...">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <select class="form-select" id="status" required>
                                <option value="active">Ù†Ø´Ø·</option>
                                <option value="on-hold">Ù…Ø¹Ù„Ù‚</option>
                                <option value="completed">Ù…ÙƒØªÙ…Ù„</option>
                                <option value="cancelled">Ù…Ù„ØºÙŠ</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dates -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="fw-bold text-primary mb-3">
                                <i class="fas fa-calendar-alt me-2"></i>
                                Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
                            </h6>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
                            <input type="date" class="form-control" id="endDate" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="border: none; padding: 1rem 2rem 2rem;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-modern btn-primary-modern" onclick="addProject()">
                    <i class="fas fa-save me-2"></i>
                    Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
                </button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='projects.js') }}"></script>

<!-- Debug Console for troubleshooting -->
<script>
    // Debug helper functions
    window.debugERP = {
        hideLoading: function () {
            forceHideLoading();
            console.log('âœ… Loading overlay hidden via debug console');
        },

        checkOverlay: function () {
            const overlay = document.getElementById('loadingOverlay');
            console.log('ğŸ” Loading overlay status:', {
                exists: !!overlay,
                display: overlay?.style.display,
                classList: overlay?.classList.toString(),
                visible: overlay?.offsetParent !== null
            });
            return overlay;
        },

        resetSystem: function () {
            if (projectManager) {
                projectManager.forceHideLoading();
                projectManager.showSuccess('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
            }
            console.log('ğŸ”„ System reset completed');
        }
    };

    // Auto-check for stuck loading every 10 seconds
    setInterval(function () {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay && (overlay.style.display === 'flex' || overlay.classList.contains('show'))) {
            if (!overlay.dataset.startTime) {
                overlay.dataset.startTime = Date.now();
            } else {
                const elapsed = Date.now() - parseInt(overlay.dataset.startTime);
                if (elapsed > 30000) { // 30 seconds
                    console.warn('âš ï¸ Loading overlay stuck, auto-hiding...');
                    forceHideLoading();
                    if (projectManager) {
                        projectManager.showError('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                    }
                }
            }
        } else if (overlay) {
            delete overlay.dataset.startTime;
        }
    }, 10000);

    console.log('ğŸ”§ ERP Debug Console loaded. Try: debugERP.hideLoading()');
</script>

<!-- Debug Console for troubleshooting -->
<script>
    // Debug helper functions
    window.debugERP = {
        hideLoading: function () {
            forceHideLoading();
            console.log('âœ… Loading overlay hidden via debug console');
        },

        showProjectManager: function () {
            console.log('ğŸ“Š ProjectManager instance:', projectManager);
            return projectManager;
        },

        checkOverlay: function () {
            const overlay = document.getElementById('loadingOverlay');
            console.log('ğŸ” Loading overlay status:', {
                exists: !!overlay,
                display: overlay?.style.display,
                classList: overlay?.classList.toString(),
                visible: overlay?.offsetParent !== null
            });
            return overlay;
        },

        resetSystem: function () {
            if (projectManager) {
                projectManager.forceHideLoading();
                projectManager.showSuccess('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
            }
            console.log('ğŸ”„ System reset completed');
        }
    };

    // Auto-check for stuck loading every 10 seconds
    setInterval(function () {
        const overlay = document.getElementById('loadingOverlay');
        if (overlay && (overlay.style.display === 'flex' || overlay.classList.contains('show'))) {
            // Check if loading has been visible for more than 30 seconds
            if (!overlay.dataset.startTime) {
                overlay.dataset.startTime = Date.now();
            } else {
                const elapsed = Date.now() - parseInt(overlay.dataset.startTime);
                if (elapsed > 30000) { // 30 seconds
                    console.warn('âš ï¸ Loading overlay stuck for more than 30 seconds, auto-hiding...');
                    forceHideLoading();
                    if (projectManager) {
                        projectManager.showError('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                    }
                }
            }
        } else if (overlay) {
            delete overlay.dataset.startTime;
        }
    }, 10000);

    // Console help message
    console.log(`
ğŸ”§ ERP System Debug Console
========================
Available commands:
- debugERP.hideLoading()     : Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
- debugERP.checkOverlay()    : ÙØ­Øµ Ø­Ø§Ù„Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„  
- debugERP.showProjectManager() : Ø¹Ø±Ø¶ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
- debugERP.resetSystem()     : Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…
    `);
</script>
{% endblock %}