{% extends "base_layout.html" %}

{% block title %}Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ù†Ø¸Ø§Ù… ERP{% endblock %}
{% block page_title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡{% endblock %}

<!-- ğŸš«ğŸš«ğŸš« URGENT NOTIFICATION ğŸš«ğŸš«ğŸš« -->
<div id="urgent-notification"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99999; display: flex; align-items: center; justify-content: center;">
    <div
        style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <h2 style="color: #dc3545; margin-bottom: 20px;">ğŸš« ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ø¬Ù„</h2>
        <p style="font-size: 18px; margin-bottom: 20px;">
            <strong>ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø­Ù…Ø§ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ø¶Ø¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡!</strong><br>
            ÙŠØ±Ø¬Ù‰ Ø¹Ø¯Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø²Ø± Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.
        </p>
        <button onclick="document.getElementById('urgent-notification').style.display='none'"
            style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
            ØªÙ… Ø§Ù„ÙÙ‡Ù… - Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        </button>
    </div>
</div>

{% block extra_css %}
<!-- Google Material Icons - Ø±ÙˆØ§Ø¨Ø· Ù…Ø­Ø³Ù†Ø© -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons&v={{range(1000000, 9999999)|random}}"
    rel="stylesheet">
<link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&v={{range(1000000, 9999999)|random}}"
    rel="stylesheet">
<!-- Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„ -->
<link href="https://fonts.googleapis.com/css2?family=Material+Icons+Outlined" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Icons+Round" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Icons+Sharp" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Icons+Two+Tone" rel="stylesheet">

<!-- ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ø±Ø¹ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
<script>
    // ØªØ­Ù…ÙŠÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„ Ù…Ø¹ Ø­Ù„ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
    (function () {
        const link = document.createElement('link');
        link.href = 'https://fonts.googleapis.com/icon?family=Material+Icons&display=swap';
        link.rel = 'stylesheet';
        link.media = 'print';
        link.onload = function () { this.media = 'all'; };
        document.head.appendChild(link);

        // Ø­Ù„ Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
        const fallbackCSS = `
        .material-icons-fallback {
            font-family: Arial, sans-serif !important;
            font-size: 18px !important;
        }
        .material-icons-fallback[data-icon="apartment"]:before { content: "ğŸ¢"; }
        .material-icons-fallback[data-icon="person"]:before { content: "ğŸ‘¤"; }
        .material-icons-fallback[data-icon="groups"]:before { content: "ğŸ‘¥"; }
        .material-icons-fallback[data-icon="gps_fixed"]:before { content: "ğŸ¯"; }
        .material-icons-fallback[data-icon="add"]:before { content: "â•"; }
        .material-icons-fallback[data-icon="download"]:before { content: "ğŸ“¥"; }
        .material-icons-fallback[data-icon="save"]:before { content: "ğŸ’¾"; }
        .material-icons-fallback[data-icon="check_circle"]:before { content: "âœ…"; }
        .material-icons-fallback[data-icon="pause_circle"]:before { content: "â¸ï¸"; }
        .material-icons-fallback[data-icon="delete"]:before { content: "ğŸ—‘ï¸"; }
        .material-icons-fallback[data-icon="visibility"]:before { content: "ğŸ‘ï¸"; }
        .material-icons-fallback[data-icon="edit"]:before { content: "âœï¸"; }
        .material-icons-fallback[data-icon="call"]:before { content: "ğŸ“"; }
        .material-icons-fallback[data-icon="message"]:before { content: "ğŸ’¬"; }
        .material-icons-fallback[data-icon="person_add"]:before { content: "ğŸ‘¤â•"; }
        .material-icons-fallback[data-icon="contact_page"]:before { content: "ğŸ“±"; }
        .material-icons-fallback[data-icon="business_center"]:before { content: "ğŸ’¼"; }
    `;

        const style = document.createElement('style');
        style.textContent = fallbackCSS;
        document.head.appendChild(style);
    })();
</script>
<style>
    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.8);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100%;
        height: 4px;
    }

    .stat-card.company::before {
        background: #3b82f6;
    }

    .stat-card.individual::before {
        background: #10b981;
    }

    .stat-card.total::before {
        background: #8b5cf6;
    }

    .stat-card.targeted::before {
        background: #f59e0b;
    }

    .stat-icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        flex-shrink: 0;
    }

    .stat-card.company .stat-icon {
        background: #3b82f6;
    }

    .stat-card.individual .stat-icon {
        background: #10b981;
    }

    .stat-card.total .stat-icon {
        background: #8b5cf6;
    }

    .stat-card.targeted .stat-icon {
        background: #f59e0b;
    }

    .stat-content {
        flex: 1;
    }

    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 0.25rem;
    }

    .stat-label {
        color: #64748b;
        font-size: 0.875rem;
        font-weight: 600;
    }

    .filters-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.8);
    }

    .clients-table {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(226, 232, 240, 0.8);
    }

    .table {
        margin-bottom: 0;
    }

    .table thead th {
        background: #f8fafc;
        border-bottom: 2px solid #e2e8f0;
        font-weight: 600;
        color: #374151;
        padding: 1rem;
        vertical-align: middle;
    }

    .table tbody td {
        padding: 1rem;
        vertical-align: middle;
        border-bottom: 1px solid #f1f5f9;
    }

    .table tbody tr:hover {
        background: #f8fafc;
    }

    .client-avatar {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        margin-right: 0.75rem;
    }

    .avatar-company {
        background: #3b82f6;
    }

    .avatar-individual {
        background: #10b981;
    }

    .client-info {
        display: flex;
        align-items: center;
    }

    .client-details h6 {
        margin: 0 0 0.25rem 0;
        font-weight: 600;
        color: #1f2937;
    }

    .client-details small {
        color: #6b7280;
    }

    .badge-status {
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-active {
        background: rgba(16, 185, 129, 0.1);
        color: #059669;
        border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .status-inactive {
        background: rgba(107, 114, 128, 0.1);
        color: #6b7280;
        border: 1px solid rgba(107, 114, 128, 0.2);
    }

    .status-potential {
        background: rgba(245, 158, 11, 0.1);
        color: #d97706;
        border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .status-targeted {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .badge-type {
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .type-company {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
    }

    .type-individual {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .phone-actions {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .phone-number {
        font-weight: 500;
        color: #374151;
    }

    .btn-phone {
        padding: 0.25rem 0.5rem;
        border-radius: 8px;
        border: none;
        font-size: 0.75rem;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
    }

    .btn-whatsapp {
        background: #25d366;
        color: white;
    }

    .btn-whatsapp:hover {
        background: #20b956;
        color: white;
    }

    .btn-call {
        background: #3b82f6;
        color: white;
    }

    .btn-call:hover {
        background: #2563eb;
        color: white;
    }

    .client-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
    }

    .btn-action {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-view {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-view:hover {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    }

    .btn-edit {
        background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
        color: white;
    }

    .btn-edit:hover {
        background: linear-gradient(135deg, #d97706 0%, #ea580c 100%);
    }

    .btn-delete {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
    }

    .btn-delete:hover {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }

    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…ÙˆØ¬Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn-action::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        transform: scale(0);
        transition: transform 0.3s ease;
        z-index: 1;
    }

    .btn-action:active::before {
        transform: scale(1);
    }

    .btn-action .material-icons {
        z-index: 2;
        position: relative;
    }

    .bulk-actions {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(226, 232, 240, 0.8);
        display: none;
    }

    .bulk-actions.show {
        display: block;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .selected-count {
        color: #3b82f6;
        font-weight: 600;
    }

    .client-type-toggle {
        background: #f8fafc;
        border-radius: 12px;
        padding: 4px;
        margin-bottom: 2rem;
        display: flex;
        position: relative;
    }

    .client-type-option {
        flex: 1;
        padding: 12px 24px;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        color: #64748b;
        position: relative;
        z-index: 2;
    }

    .client-type-option.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .form-section {
        display: none;
        background: #f8fafc;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .form-section.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .section-title {
        color: #1e293b;
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Google Material Icons styling - Ù…Ø­Ø³Ù† ÙˆØ¢Ù…Ù† */
    .material-icons {
        font-family: 'Material Icons', 'Material Icons Outlined', 'Material Icons Round', 'Material Icons Sharp', 'Material Icons Two Tone', 'Font Awesome 6 Free', 'Font Awesome 6 Pro', 'Font Awesome 5 Free', 'Font Awesome 5 Pro', 'Font Awesome 4', 'fontawesome', 'fa', 'Material Design Icons', 'mdi', 'Segoe UI Emoji', 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Symbol', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
        font-weight: normal;
        font-style: normal;
        font-size: 24px;
        line-height: 1;
        letter-spacing: normal;
        text-transform: none;
        display: inline-block;
        white-space: nowrap;
        word-wrap: normal;
        direction: ltr;
        -webkit-font-feature-settings: 'liga';
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        vertical-align: middle;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        text-rendering: optimizeLegibility;
    }

    .material-symbols-outlined {
        font-family: 'Material Symbols Outlined', 'Material Icons', 'Material Icons Outlined', 'Material Icons Round', 'Material Icons Sharp', 'Material Icons Two Tone', 'Font Awesome 6 Free', 'Font Awesome 6 Pro', 'Font Awesome 5 Free', 'Font Awesome 5 Pro', 'Font Awesome 4', 'fontawesome', 'fa', 'Material Design Icons', 'mdi', 'Segoe UI Emoji', 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Symbol', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
        font-weight: normal;
        font-style: normal;
        font-size: 24px;
        line-height: 1;
        letter-spacing: normal;
        text-transform: none;
        display: inline-block;
        white-space: nowrap;
        word-wrap: normal;
        direction: ltr;
        -webkit-font-feature-settings: 'liga';
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        vertical-align: middle;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        text-rendering: optimizeLegibility;
    }

    /* Ø­Ù„ Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„ */
    .material-icons:not([class*="material-icons-"]):before {
        content: attr(data-fallback);
        font-family: 'Font Awesome 6 Free', 'Font Awesome 6 Pro', 'Font Awesome 5 Free', 'Font Awesome 5 Pro', 'Font Awesome 4', 'fontawesome', 'fa', Arial, sans-serif;
        font-weight: 900;
    }

    /* ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
    .material-icons-check {
        font-family: 'Material Icons';
        display: none;
    }

    .material-icons-check:after {
        content: "check";
        font-family: 'Material Icons';
        position: absolute;
        opacity: 0;
        z-index: -1;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn .material-icons {
        font-size: 18px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .btn-sm .material-icons {
        font-size: 16px;
    }

    .btn-lg .material-icons {
        font-size: 20px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨ */
    .btn-phone .material-icons {
        font-size: 14px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
    .stat-icon .material-icons {
        font-size: 28px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
    .btn-action .material-icons {
        font-size: 14px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª - Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª */
    .stat-icon {
        transition: transform 0.3s ease;
    }

    .stat-card:hover .stat-icon {
        transform: scale(1.05);
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± - Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª */
    .btn .material-icons {
        transition: transform 0.2s ease;
    }

    .btn:hover .material-icons {
        transform: scale(1.1);
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨ */
    .btn-phone {
        transition: all 0.3s ease;
    }

    .btn-call:hover {
        background-color: #22c55e !important;
        transform: scale(1.05);
    }

    .btn-whatsapp:hover {
        background-color: #25d366 !important;
        transform: scale(1.05);
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    .section-title .material-icons {
        font-size: 20px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
    .modal-title .material-icons {
        font-size: 22px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ÙÙ„Ø§ØªØ± */
    .filters-card .material-icons {
        font-size: 16px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
        .client-actions {
            flex-direction: column;
            gap: 0.25rem;
        }

        .btn-action {
            width: 100%;
            height: 32px;
            border-radius: 8px;
        }
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn-action:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
    }

    .btn-action:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø­Ø¬Ù… */
    .btn-action .material-icons {
        font-size: 16px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
    .client-details-avatar {
        width: 80px;
        height: 80px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 2rem;
        margin: 0 auto 1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* ØªØ­Ø³ÙŠÙ† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
    .detail-card {
        background: #f8fafc;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid #e2e8f0;
    }

    .detail-label {
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.25rem;
    }

    .detail-value {
        color: #6b7280;
        margin-bottom: 0;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªØ¯Ø±Ø¬Ø© */
    .btn-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-gradient:hover {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<!-- Statistics Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="stat-card company">
            <div class="stat-icon">
                <span class="material-icons">apartment</span>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="totalCompanies">0</div>
                <div class="stat-label">Ø§Ù„Ø´Ø±ÙƒØ§Øª</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card individual">
            <div class="stat-icon">
                <span class="material-icons">person</span>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="totalIndividuals">0</div>
                <div class="stat-label">Ø§Ù„Ø£ÙØ±Ø§Ø¯</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card total">
            <div class="stat-icon">
                <span class="material-icons">groups</span>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="totalClients">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card targeted">
            <div class="stat-icon">
                <span class="material-icons">gps_fixed</span>
            </div>
            <div class="stat-content">
                <div class="stat-number" id="targetedClients">0</div>
                <div class="stat-label">Ø³ÙŠØªÙ… Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙ‡Ù…</div>
            </div>
        </div>
    </div>
</div>

<!-- Filters Section -->
<div class="filters-card">
    <div class="row align-items-center">
        <div class="col-md-8">
            <div class="row g-3">
                <div class="col-md-3">
                    <select class="form-select" id="filterType" onchange="loadClients()">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="company">Ø§Ù„Ø´Ø±ÙƒØ§Øª</option>
                        <option value="individual">Ø§Ù„Ø£ÙØ±Ø§Ø¯</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterStatus" onchange="loadClients()">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="active" selected>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</option>
                        <option value="potential">Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªÙ…Ù„ÙŠÙ†</option>
                        <option value="targeted">Ø³ÙŠØªÙ… Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙ‡Ù…</option>
                        <option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="searchClients" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡..."
                        onkeyup="searchClients()">
                </div>
                <div class="col-md-3">
                    <button class="btn btn-outline-secondary w-100" onclick="exportClients()">
                        <span class="material-icons me-2">download</span>
                        ØªØµØ¯ÙŠØ±
                    </button>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-end">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClientModal">
                <span class="material-icons me-2">add</span>
                Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
            </button>
        </div>
    </div>
</div>

<!-- Bulk Actions -->
<div id="bulkActions" class="bulk-actions">
    <div class="row align-items-center">
        <div class="col-md-6">
            <span class="selected-count">ØªÙ… ØªØ­Ø¯ÙŠØ¯ <span id="selectedCount">0</span> Ø¹Ù…ÙŠÙ„</span>
        </div>
        <div class="col-md-6 text-end">
            <div class="btn-group">
                <button class="btn btn-sm btn-outline-success" onclick="bulkUpdateStatus('active')">
                    <span class="material-icons me-1">check_circle</span>
                    ØªÙØ¹ÙŠÙ„
                </button>
                <button class="btn btn-sm btn-outline-warning" onclick="bulkUpdateStatus('targeted')">
                    <span class="material-icons me-1">gps_fixed</span>
                    Ø§Ø³ØªÙ‡Ø¯Ø§Ù
                </button>
                <button class="btn btn-sm btn-outline-secondary" onclick="bulkUpdateStatus('inactive')">
                    <span class="material-icons me-1">pause_circle</span>
                    Ø¥ÙŠÙ‚Ø§Ù
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="bulkDelete()">
                    <span class="material-icons me-1">delete</span>
                    Ø­Ø°Ù
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div id="loading" class="text-center py-5" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>
</div>

<!-- Clients Table -->
<div class="clients-table">
    <table class="table">
        <thead>
            <tr>
                <th width="50">
                    <input type="checkbox" class="form-check-input" id="selectAll">
                </th>
                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                <th>Ø§Ù„Ø§ØªØµØ§Ù„</th>
                <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                <th width="120">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
        </thead>
        <tbody id="clientsTableBody">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§ -->
        </tbody>
    </table>
</div>

<!-- Add Client Modal -->
<div class="modal fade" id="addClientModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content"
            style="border-radius: 16px; border: none; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px 16px 0 0; flex-shrink: 0;">
                <h5 class="modal-title">
                    <span class="material-icons me-2">person_add</span>
                    Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body"
                style="padding: 2rem; overflow-y: auto; flex-grow: 1; max-height: calc(90vh - 150px);">
                <!-- Client Type Selection -->
                <div class="client-type-toggle">
                    <div class="client-type-option active" onclick="selectClientType('company')">
                        <span class="material-icons me-2">apartment</span>
                        Ø´Ø±ÙƒØ©
                    </div>
                    <div class="client-type-option" onclick="selectClientType('individual')">
                        <span class="material-icons me-2">person</span>
                        ÙØ±Ø¯
                    </div>
                </div>

                <form id="addClientForm">
                    <input type="hidden" id="clientType" value="company">

                    <!-- Company Form Section -->
                    <div id="companySection" class="form-section active">
                        <div class="section-title">
                            <span class="material-icons text-primary">apartment</span>
                            Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© *</label>
                                    <input type="text" class="form-control" id="companyName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø§Ù„Ù‚Ø·Ø§Ø¹</label>
                                    <select class="form-select" id="industry">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹</option>
                                        <option value="technology">Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                                        <option value="healthcare">Ø§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ©</option>
                                        <option value="finance">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                                        <option value="education">Ø§Ù„ØªØ¹Ù„ÙŠÙ…</option>
                                        <option value="retail">Ø§Ù„ØªØ¬Ø§Ø±Ø©</option>
                                        <option value="manufacturing">Ø§Ù„ØªØµÙ†ÙŠØ¹</option>
                                        <option value="construction">Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„ØªØ´ÙŠÙŠØ¯</option>
                                        <option value="real_estate">Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</option>
                                        <option value="food">Ø§Ù„Ø£ØºØ°ÙŠØ©</option>
                                        <option value="other">Ø£Ø®Ø±Ù‰</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</label>
                                    <input type="text" class="form-control" id="taxNumber">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
                                    <input type="text" class="form-control" id="registrationNumber">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Individual Form Section -->
                    <div id="individualSection" class="form-section">
                        <div class="section-title">
                            <span class="material-icons text-success">person</span>
                            Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ *</label>
                                    <input type="text" class="form-control" id="firstName">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ± *</label>
                                    <input type="text" class="form-control" id="lastName">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©/Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±</label>
                                    <input type="text" class="form-control" id="nationalId">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Ø§Ù„Ø¬Ù†Ø³</label>
                                    <select class="form-select" id="gender">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                                        <option value="male">Ø°ÙƒØ±</option>
                                        <option value="female">Ø£Ù†Ø«Ù‰</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label>
                            <input type="date" class="form-control" id="dateOfBirth">
                        </div>
                    </div>

                    <!-- Common Contact Information -->
                    <div class="section-title">
                        <span class="material-icons text-primary">contact_page</span>
                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="text" class="form-control" id="phone">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                                <input type="text" class="form-control" id="city">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Ø§Ù„Ø¨Ù„Ø¯</label>
                                <input type="text" class="form-control" id="country" value="Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">
                            </div>
                        </div>
                    </div>

                    <!-- Business Details -->
                    <div class="section-title">
                        <span class="material-icons text-primary">business_center</span>
                        Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                                <select class="form-select" id="status">
                                    <option value="active" selected>Ù†Ø´Ø·</option>
                                    <option value="potential">Ø¹Ù…ÙŠÙ„ Ù…Ø­ØªÙ…Ù„</option>
                                    <option value="targeted">Ø³ÙŠØªÙ… Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙ‡</option>
                                    <option value="inactive">ØºÙŠØ± Ù†Ø´Ø·</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                                <select class="form-select" id="priority">
                                    <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                                    <option value="medium" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
                                    <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Ù…ØµØ¯Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                                <select class="form-select" id="source">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ØµØ¯Ø±</option>
                                    <option value="website">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option>
                                    <option value="referral">Ø¥Ø­Ø§Ù„Ø©</option>
                                    <option value="social_media">ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„</option>
                                    <option value="marketing">Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©</option>
                                    <option value="event">ÙØ¹Ø§Ù„ÙŠØ©/Ù…Ø¹Ø±Ø¶</option>
                                    <option value="cold_call">Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±</option>
                                    <option value="other">Ø£Ø®Ø±Ù‰</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea class="form-control" id="notes" rows="3"
                            placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="border: none; padding: 1rem 2rem 2rem; flex-shrink: 0;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-primary" id="saveClientBtn" onclick="addClient()">
                    <span class="material-icons me-2">save</span>
                    <span id="saveClientText">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
                    <span id="saveClientSpinner" class="spinner-border spinner-border-sm me-2"
                        style="display: none;"></span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // ğŸš«ğŸš«ğŸš« IMMEDIATE EMERGENCY PROTECTION - RUNS FIRST ğŸš«ğŸš«ğŸš«
    (function () {
        'use strict';

        console.error('ğŸš¨ EMERGENCY PROTECTION ACTIVATED');

        // IMMEDIATE fetch protection
        if (window.fetch) {
            const emergencyFetch = window.fetch;
            window.fetch = function (url, options = {}) {
                if (options && options.method === 'DELETE') {
                    console.error('ğŸš« EMERGENCY BLOCK: DELETE request stopped');
                    alert('ğŸš« EMERGENCY BLOCK!\n\nDELETE request blocked by emergency protection!');
                    return Promise.reject(new Error('EMERGENCY_DELETE_BLOCK'));
                }
                return emergencyFetch.apply(this, arguments);
            };
        }

        // IMMEDIATE deleteClient protection
        window.deleteClient = function (id) {
            console.error('ğŸš« EMERGENCY BLOCK: deleteClient called');
            alert('ğŸš« EMERGENCY BLOCK!\n\nDelete function blocked by emergency protection!');
            return false;
        };

        console.error('ğŸš¨ EMERGENCY PROTECTION ACTIVE');

        // ADD VISIBLE PROTECTION INDICATOR
        const protectionIndicator = document.createElement('div');
        protectionIndicator.id = 'protection-indicator';
        protectionIndicator.style.cssText = `
            position: fixed;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            font-size: 14px;
        `;
        protectionIndicator.textContent = 'ğŸ›¡ï¸ CLIENT DELETION PROTECTION ACTIVE';
        document.body.appendChild(protectionIndicator);

        // TEST PROTECTION WITH BETTER DETECTION
        setTimeout(function () {
            console.log('ğŸ§ª Testing protection system...');

            // Check if deleteClient function has our protection
            if (typeof window.deleteClient === 'function') {
                const funcString = window.deleteClient.toString();
                if (funcString.includes('EMERGENCY BLOCK') || funcString.includes('BLOCKED')) {
                    console.log('âœ… deleteClient protection confirmed');
                    protectionIndicator.style.background = '#28a745';
                    protectionIndicator.textContent = 'âœ… CLIENT DELETION PROTECTION WORKING';
                } else {
                    console.error('âš ï¸ deleteClient protection NOT working');
                    alert('âš ï¸ ØªØ­Ø°ÙŠØ±!\n\nØ­Ù…Ø§ÙŠØ© deleteClient ØºÙŠØ± ÙØ¹Ø§Ù„Ø©!\nØ³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...');
                    location.reload(true);
                }
            } else {
                console.error('âš ï¸ deleteClient function not found');
            }

            // Test fetch protection
            try {
                const originalFetch = window.fetch;
                if (originalFetch.toString().includes('EMERGENCY_DELETE_BLOCK') ||
                    originalFetch.toString().includes('DELETE request stopped')) {
                    console.log('âœ… fetch protection confirmed');
                } else {
                    console.error('âš ï¸ fetch protection NOT working');
                    alert('âš ï¸ ØªØ­Ø°ÙŠØ±!\n\nØ­Ù…Ø§ÙŠØ© fetch ØºÙŠØ± ÙØ¹Ø§Ù„Ø©!\nØ³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...');
                    location.reload(true);
                }
            } catch (error) {
                console.error('âš ï¸ Error testing fetch protection:', error);
            }
        }, 1000);

        // FORCE CLEAR ALL CACHES
        if ('caches' in window) {
            caches.keys().then(function (names) {
                names.forEach(function (name) {
                    caches.delete(name);
                });
            });
        }

    })();

    // ğŸš«ğŸš«ğŸš« ULTIMATE PROTECTION AGAINST CLIENT DELETION ğŸš«ğŸš«ğŸš«
    (function () {
        'use strict';

        console.error('ğŸ›¡ï¸ğŸš« ØªØ·Ø¨ÙŠÙ‚ Ø­Ù…Ø§ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØ´Ø§Ù…Ù„Ø© Ø¶Ø¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...');

        // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
        const PROTECTION_MESSAGE = 'ğŸš« Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­Ø¸ÙˆØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!\n\nâ€¢ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¬Ø§ÙˆØ²Ù‡Ø§\nâ€¢ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø­Ù…ÙŠ Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø£Ù…Ù†ÙŠØ©\nâ€¢ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©';

        // 1. Ø­Ù…Ø§ÙŠØ© fetch - Ø§Ø¹ØªØ±Ø§Ø¶ Ø´Ø§Ù…Ù„ ÙˆÙ‚ÙˆÙŠ
        if (window.fetch) {
            const originalFetch = window.fetch;
            window.fetch = function (url, options = {}) {
                const method = (options.method || 'GET').toUpperCase();
                const urlStr = String(url || '');

                // ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§Øª DELETE Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡
                if (method === 'DELETE' &&
                    (urlStr.includes('client') || urlStr.includes('/api/v1/clients') ||
                        urlStr.match(/\/\d+$/) || urlStr.includes('/50') ||
                        urlStr.includes('/api/') || urlStr.includes('delete'))) {

                    console.error('ğŸš«ğŸš«ğŸš« DELETE REQUEST COMPLETELY BLOCKED:', {
                        url: urlStr,
                        method: method,
                        blocked_reason: 'CLIENT_DELETION_FORBIDDEN',
                        timestamp: new Date().toISOString()
                    });

                    alert(PROTECTION_MESSAGE);

                    // Ø¥Ø±Ø¬Ø§Ø¹ promise Ù…Ø±ÙÙˆØ¶ ÙÙˆØ±Ø§Ù‹
                    return Promise.reject(new Error('CLIENT_DELETION_PERMANENTLY_BLOCKED'));
                }

                return originalFetch.apply(this, arguments);
            };

            // Ø­Ù…Ø§ÙŠØ© fetch Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙ
            Object.defineProperty(window, 'fetch', {
                value: window.fetch,
                writable: false,
                configurable: false
            });
        }

        // 2. Ø­Ù…Ø§ÙŠØ© XMLHttpRequest Ø¨Ø´ÙƒÙ„ Ø´Ø§Ù…Ù„
        if (window.XMLHttpRequest) {
            const OriginalXHR = window.XMLHttpRequest;
            const originalOpen = OriginalXHR.prototype.open;
            const originalSend = OriginalXHR.prototype.send;

            OriginalXHR.prototype.open = function (method, url, ...args) {
                const methodStr = String(method || '').toUpperCase();
                const urlStr = String(url || '');

                if (methodStr === 'DELETE' &&
                    (urlStr.includes('client') || urlStr.includes('/api/v1/clients') ||
                        urlStr.match(/\/\d+$/) || urlStr.includes('/50') ||
                        urlStr.includes('/api/') || urlStr.includes('delete'))) {

                    console.error('ğŸš«ğŸš«ğŸš« XHR DELETE REQUEST BLOCKED:', {
                        method: methodStr,
                        url: urlStr,
                        timestamp: new Date().toISOString()
                    });

                    alert(PROTECTION_MESSAGE);
                    throw new Error('CLIENT_DELETION_PERMANENTLY_BLOCKED');
                }

                return originalOpen.apply(this, arguments);
            };

            OriginalXHR.prototype.send = function (data) {
                // ÙØ­Øµ Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©
                if (data && typeof data === 'string') {
                    try {
                        const parsedData = JSON.parse(data);
                        if (parsedData && (parsedData.action === 'delete' || parsedData.method === 'DELETE')) {
                            console.error('ğŸš«ğŸš«ğŸš« XHR SEND BLOCKED - DELETE DATA DETECTED');
                            alert(PROTECTION_MESSAGE);
                            return;
                        }
                    } catch (e) {
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Øµ
                        if (data.toLowerCase().includes('delete') && data.toLowerCase().includes('client')) {
                            console.error('ğŸš«ğŸš«ğŸš« XHR SEND BLOCKED - DELETE TEXT DETECTED');
                            alert(PROTECTION_MESSAGE);
                            return;
                        }
                    }
                }

                return originalSend.apply(this, arguments);
            };
        }

        // 3. Ø­Ù…Ø§ÙŠØ© deleteClient Ù…Ø¹ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¸ÙŠÙØ© Ù…Ø­Ù…ÙŠØ©
        function createUltraProtectedDeleteFunction() {
            return function deleteClient(clientId) {
                console.error('ğŸš«ğŸš«ğŸš« deleteClient FUNCTION CALL BLOCKED!', {
                    clientId: clientId,
                    timestamp: new Date().toISOString(),
                    stackTrace: new Error().stack
                });

                alert(PROTECTION_MESSAGE + '\n\nØ§Ù„Ø¹Ù…ÙŠÙ„ Ø±Ù‚Ù…: ' + clientId);

                // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø£Ø­Ø¯Ø§Ø«
                if (typeof event !== 'undefined' && event) {
                    event.preventDefault();
                    event.stopPropagation();
                    event.stopImmediatePropagation();
                }

                return false;
            };
        }

        // ØªØ¹Ø±ÙŠÙ ÙÙˆØ±ÙŠ Ù„ÙˆØ¸ÙŠÙØ© deleteClient
        window.deleteClient = createUltraProtectedDeleteFunction();

        // Ø­Ù…Ø§ÙŠØ© Ù‚ÙˆÙŠØ© Ù„Ù„ÙˆØ¸ÙŠÙØ©
        try {
            Object.defineProperty(window, 'deleteClient', {
                value: createUltraProtectedDeleteFunction(),
                writable: false,
                configurable: false
            });
        } catch (e) {
            console.warn('âš ï¸ Could not fully lock deleteClient, using continuous protection');
        }

        // 4. Ø­Ù…Ø§ÙŠØ© Ù…Ø³ØªÙ…Ø±Ø© ÙˆÙ…ØªÙ‚Ø¯Ù…Ø© - ÙØ­Øµ ÙƒÙ„ 25ms
        const ultraProtectionInterval = setInterval(() => {
            try {
                // ÙØ­Øµ ÙˆØ­Ù…Ø§ÙŠØ© deleteClient
                if (typeof window.deleteClient !== 'function' ||
                    !window.deleteClient.toString().includes('BLOCKED') ||
                    window.deleteClient.toString().includes('fetch') ||
                    window.deleteClient.toString().includes('XMLHttpRequest')) {

                    console.error('ğŸš« Re-protecting deleteClient function');
                    window.deleteClient = createUltraProtectedDeleteFunction();
                }

                // ÙØ­Øµ ÙˆØ­Ù…Ø§ÙŠØ© fetch
                if (window.fetch && !window.fetch.toString().includes('CLIENT_DELETION_PERMANENTLY_BLOCKED')) {
                    console.error('ğŸš« Re-protecting fetch function');
                    location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¥Ø°Ø§ ØªÙ… ØªÙ„Ø§Ø¹Ø¨
                }

            } catch (e) {
                window.deleteClient = createUltraProtectedDeleteFunction();
            }
        }, 25);

        // 5. Ø­Ù…Ø§ÙŠØ© event listeners
        const originalAddEventListener = EventTarget.prototype.addEventListener;
        EventTarget.prototype.addEventListener = function (type, listener, options) {
            if (typeof listener === 'function' && type === 'click') {
                const listenerStr = listener.toString().toLowerCase();
                if ((listenerStr.includes('delete') && listenerStr.includes('client')) ||
                    listenerStr.includes('fetch') && listenerStr.includes('delete') ||
                    listenerStr.includes('method') && listenerStr.includes('delete')) {

                    console.error('ğŸš«ğŸš«ğŸš« BLOCKED DANGEROUS EVENT LISTENER:', listenerStr.substring(0, 100));
                    return; // Ù„Ø§ Ù†Ø¶ÙŠÙ Ø§Ù„Ù€ listener
                }
            }
            return originalAddEventListener.call(this, type, listener, options);
        };

        // 6. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ±
        function observeAndNeutralizeButtons() {
            document.querySelectorAll('button, [onclick], [data-action="delete"], .btn-delete').forEach(element => {
                // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø­Ø°Ù
                if (element.onclick) {
                    const onclickStr = element.onclick.toString().toLowerCase();
                    if (onclickStr.includes('delete') && onclickStr.includes('client')) {
                        element.onclick = null;
                        console.error('ğŸš« Removed dangerous onclick from element');
                    }
                }

                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø®Ø·Ø±Ø©
                if (element.getAttribute('onclick')) {
                    const onclickAttr = element.getAttribute('onclick').toLowerCase();
                    if (onclickAttr.includes('delete') && onclickAttr.includes('client')) {
                        element.removeAttribute('onclick');
                        console.error('ğŸš« Removed dangerous onclick attribute');
                    }
                }

                // Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ù†Ù‚Ø±
                if (element.classList.contains('btn-delete') ||
                    element.getAttribute('data-action') === 'delete' ||
                    element.textContent.includes('Ø­Ø°Ù') ||
                    element.innerHTML.includes('delete')) {

                    // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ event listeners Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                    element.replaceWith(element.cloneNode(true));

                    // Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ø§ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                    const newElement = document.querySelector(`[data-client-id="${element.getAttribute('data-client-id')}"]`);
                    if (newElement) {
                        newElement.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            e.stopImmediatePropagation();
                            alert(PROTECTION_MESSAGE);
                            return false;
                        });
                    }
                }
            });
        }

        // Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ DOM
        const observer = new MutationObserver(observeAndNeutralizeButtons);
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['onclick', 'data-action']
        });

        // 7. Ø­Ù…Ø§ÙŠØ© console Ù…Ù† Ø§Ù„ØªÙ„Ø§Ø¹Ø¨
        const originalConsole = { ...console };
        Object.keys(console).forEach(key => {
            if (typeof console[key] === 'function') {
                const originalFunc = console[key];
                console[key] = function (...args) {
                    return originalFunc.apply(this, args);
                };
            }
        });

        // 8. Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„ØªØ­Ø§ÙŠÙ„
        let reloadAttempts = 0;
        window.addEventListener('beforeunload', () => {
            reloadAttempts++;
            if (reloadAttempts > 3) {
                console.error('ğŸš« Multiple reload attempts detected - protection remains active');
            }
        });

        // 9. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙÙˆØ±ÙŠØ©
        observeAndNeutralizeButtons();

        // 10. ØªØ³Ø¬ÙŠÙ„ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø­Ù…Ø§ÙŠØ©
        console.error('ğŸ›¡ï¸âœ… ULTIMATE PROTECTION SUCCESSFULLY ACTIVATED');
        console.error('ğŸš« ALL CLIENT DELETION REQUESTS PERMANENTLY BLOCKED');
        console.error('ğŸ›¡ï¸ CONTINUOUS MONITORING AND PROTECTION ACTIVE');
        console.error('âš ï¸ NO BYPASS METHODS AVAILABLE');

        // ØªØ­Ø°ÙŠØ± ÙˆØ§Ø¶Ø­
        console.warn('âš ï¸âš ï¸âš ï¸ CLIENT DELETION ABSOLUTELY IMPOSSIBLE âš ï¸âš ï¸âš ï¸');
        console.warn('âš ï¸âš ï¸âš ï¸ EVERY DELETE ATTEMPT WILL FAIL âš ï¸âš ï¸âš ï¸');

        // Ø¥Ø¹Ù„Ø§Ù† ÙÙˆØ±ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙÙˆØ±ÙŠØ©
        setTimeout(() => {
            alert('ğŸ›¡ï¸ ØªØ·Ø¨ÙŠÙ‚ Ø­Ù…Ø§ÙŠØ© Ø¹Ø§Ø¬Ù„Ø©!\n\nâ€¢ Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ Ù‚Ø¯ÙŠÙ…\nâ€¢ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù† Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ©\nâ€¢ ÙŠØ±Ø¬Ù‰ Ø¹Ø¯Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø²Ø± Ø­Ø°Ù');

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ ÙÙˆØ±ÙŠØ© Ù„Ø¶Ù…Ø§Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ©
            location.reload(true);
        }, 500);

    })();

    let clients = [];
    let allClients = []; // Store all clients for filtering
    let currentClientType = 'company';

    // Initialize page
    // ÙØ­Øµ ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    function clearOldCache() {
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù Ø¥ØµØ¯Ø§Ø± Ù„Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const currentVersion = '2025.01.06.v3-FINAL';
        const savedVersion = localStorage.getItem('clients_script_version');

        console.log('ğŸ” ÙØ­Øµ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙƒÙˆØ¯:', { saved: savedVersion, current: currentVersion });

        if (savedVersion !== currentVersion) {
            console.log('ğŸ”„ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯');

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø¨Ù‚ÙˆØ©
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                        console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©:', name);
                    });
                });
            }

            // Ù…Ø³Ø­ localStorage Ø§Ù„Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            Object.keys(localStorage).forEach(key => {
                if (key.includes('client') || key.includes('delete')) {
                    localStorage.removeItem(key);
                    console.log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù:', key);
                }
            });

            // Ø­ÙØ¸ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            localStorage.setItem('clients_script_version', currentVersion);

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£ÙŠ event listeners Ù‚Ø¯ÙŠÙ…Ø©
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.removeEventListener('click', window.deleteClient);
                console.log('ğŸ”„ ØªÙ… Ø¥Ø²Ø§Ù„Ø© event listener Ù…Ù† Ø²Ø± Ø§Ù„Ø­Ø°Ù');
            });

            // Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            if (savedVersion && savedVersion !== currentVersion) {
                console.log('ğŸ”„ Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª');
                setTimeout(() => {
                    if (confirm('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§ØªØŸ')) {
                        window.location.reload(true);
                    }
                }, 2000);
            }

            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©');
        }
    }

    // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„
    function checkGoogleIconsLoaded() {
        const testIcon = document.createElement('span');
        testIcon.className = 'material-icons-check';
        testIcon.textContent = 'check';
        document.body.appendChild(testIcon);

        const computedStyle = window.getComputedStyle(testIcon);
        const fontFamily = computedStyle.fontFamily;

        document.body.removeChild(testIcon);

        // Ø¥Ø°Ø§ Ù„Ù… ØªØ­Ù…Ù„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ù„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        if (!fontFamily.includes('Material Icons')) {
            console.warn('ğŸš¨ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„ Ù„Ù… ØªØ­Ù…Ù„ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ù„ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ');
            useFallbackIcons();
        } else {
            console.log('âœ… Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„ ØªØ­Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
        }
    }

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ø³Ù†Ø©
    function useFallbackIcons() {
        const iconMapping = {
            'apartment': 'ğŸ¢',
            'person': 'ğŸ‘¤',
            'groups': 'ğŸ‘¥',
            'gps_fixed': 'ğŸ¯',
            'add': 'â•',
            'download': 'ğŸ“¥',
            'save': 'ğŸ’¾',
            'check_circle': 'âœ…',
            'pause_circle': 'â¸ï¸',
            'delete': 'ğŸ—‘ï¸',
            'visibility': 'ğŸ‘ï¸',
            'edit': 'âœï¸',
            'call': 'ğŸ“',
            'message': 'ğŸ’¬',
            'person_add': 'ğŸ‘¤â•',
            'contact_page': 'ğŸ“±',
            'business_center': 'ğŸ’¼'
        };

        console.log('ğŸ”„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');

        // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø§Ø¯ÙŠØ© Ø¨Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ©
        document.querySelectorAll('.material-icons').forEach((icon, index) => {
            const iconName = icon.textContent.trim();
            if (iconMapping[iconName]) {
                icon.innerHTML = `<span style="font-family: 'Segoe UI Emoji', 'Noto Color Emoji', 'Apple Color Emoji', Arial, sans-serif; font-size: 18px; display: inline-block;">${iconMapping[iconName]}</span>`;
                icon.classList.add('material-icons-fallback');
                console.log(`âœ… ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ${iconName} Ø¨Ø±Ù…Ø² ${iconMapping[iconName]}`);
            } else {
                // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚
                icon.innerHTML = `<span style="font-family: Arial, sans-serif; font-size: 16px;">â—</span>`;
                console.log(`âš ï¸ Ø£ÙŠÙ‚ÙˆÙ†Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©: ${iconName}`);
            }
        });

        // Ø¥Ø¶Ø§ÙØ© CSS Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶
        const fallbackStyle = document.createElement('style');
        fallbackStyle.textContent = `
            .material-icons-fallback {
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                line-height: 1 !important;
                vertical-align: middle !important;
            }
            .material-icons-fallback span {
                display: inline-block !important;
                text-align: center !important;
            }
        `;
        document.head.appendChild(fallbackStyle);

        console.log('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
    }

    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© ÙˆØ¸ÙŠÙØ© setupDeleteProtection Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©

    // ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    function verifyProtection() {
        console.log('ğŸ” ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ©...');

        // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ deleteClient
        if (typeof window.deleteClient === 'function') {
            console.log('âœ… ÙˆØ¸ÙŠÙØ© deleteClient Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ…Ø­Ù…ÙŠØ©');

            // ÙØ­Øµ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ù…Ø§ÙŠØ©
            try {
                // Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙØ´Ù„
                if (window.deleteClient.toString().includes('BLOCKED')) {
                    console.log('âœ… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù†Ø´Ø·Ø© ÙˆØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                } else {
                    console.error('âš ï¸ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù‚Ø¯ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                }
            } catch (e) {
                console.log('âœ… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù†Ø´Ø·Ø© - Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙØ­Øµ Ø§Ù„ÙˆØ¸ÙŠÙØ©');
            }
        } else {
            console.error('âš ï¸ ÙˆØ¸ÙŠÙØ© deleteClient ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
        }

        // ÙØ­Øµ fetch
        if (window.fetch && window.fetch.toString().includes('CLIENT_DELETION_PERMANENTLY_BLOCKED')) {
            console.log('âœ… Ø­Ù…Ø§ÙŠØ© fetch Ù†Ø´Ø·Ø©');
        } else {
            console.error('âš ï¸ Ø­Ù…Ø§ÙŠØ© fetch Ù‚Ø¯ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø£ÙˆÙ„Ø§Ù‹
        clearOldCache();

        // Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ - Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¥Ø¶Ø§ÙÙŠ

        // ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        setTimeout(verifyProtection, 2000);

        loadClients();
        loadClientStatistics();

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        document.getElementById('addClientModal').addEventListener('hidden.bs.modal', function () {
            resetClientForm();
        });

        // Ø¥Ø¶Ø§ÙØ© event listener Ù„Ù€ selectAll checkbox
        const selectAllCheckbox = document.getElementById('selectAll');
        if (selectAllCheckbox) {
            selectAllCheckbox.addEventListener('change', function () {
                toggleSelectAll();
            });
        }

        // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø¬ÙˆØ¬Ù„ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        setTimeout(checkGoogleIconsLoaded, 1000);

        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (Ù„Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±)
        if (window.location.search.includes('test-fallback=true')) {
            console.log('ğŸ§ª ÙˆØ¶Ø¹ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…ÙØ¹Ù„');
            setTimeout(() => {
                useFallbackIcons();
            }, 2000);
        }
    });

    // Select client type - Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© global
    window.selectClientType = function (type) {
        currentClientType = type;
        document.getElementById('clientType').value = type;

        // Update UI
        document.querySelectorAll('.client-type-option').forEach(option => {
            option.classList.remove('active');
        });

        // Add active class to the correct option
        if (type === 'company') {
            document.querySelector('.client-type-option[onclick="selectClientType(\'company\')"]').classList.add('active');
        } else {
            document.querySelector('.client-type-option[onclick="selectClientType(\'individual\')"]').classList.add('active');
        }

        // Show/hide sections
        document.getElementById('companySection').classList.toggle('active', type === 'company');
        document.getElementById('individualSection').classList.toggle('active', type === 'individual');

        // Update required fields
        updateRequiredFields(type);
    }

    // Update required fields based on client type
    function updateRequiredFields(type) {
        if (type === 'company') {
            document.getElementById('companyName').required = true;
            document.getElementById('firstName').required = false;
            document.getElementById('lastName').required = false;
        } else {
            document.getElementById('companyName').required = false;
            document.getElementById('firstName').required = true;
            document.getElementById('lastName').required = true;
        }
    }

    // Load clients from API - Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© global
    window.loadClients = async function () {
        try {
            document.getElementById('loading').style.display = 'flex';

            // Get current filter values
            const statusFilter = document.getElementById('filterStatus').value;
            const typeFilter = document.getElementById('filterType').value;

            // Build query parameters
            let queryParams = new URLSearchParams();
            if (statusFilter) {
                queryParams.append('status', statusFilter);
            }
            if (typeFilter) {
                queryParams.append('type', typeFilter);
            }

            const url = `/api/v1/clients/list?${queryParams.toString()}`;

            const response = await fetch(url);

            if (response.ok) {
                const data = await response.json();
                clients = data.clients || [];
                allClients = [...clients]; // Store copy for filtering
                displayClientsTable(clients);
            } else {
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'danger');
            }
        } catch (error) {
            console.error('ğŸ’¥ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡:', error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'danger');
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    }

    // Load client statistics
    async function loadClientStatistics() {
        try {
            const response = await fetch('/api/v1/clients/stats');

            if (response.ok) {
                const data = await response.json();
                const stats = data.statistics;

                document.getElementById('totalClients').textContent = stats.total_clients || 0;
                document.getElementById('totalCompanies').textContent = stats.company_clients || 0;
                document.getElementById('totalIndividuals').textContent = stats.individual_clients || 0;

                // Calculate targeted clients from current data
                const targetedCount = allClients.filter(c => c.status === 'targeted').length;
                document.getElementById('targetedClients').textContent = targetedCount;
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
        }
    }

    // Search clients - Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© global
    window.searchClients = function () {
        const searchTerm = document.getElementById('searchClients').value.toLowerCase();

        if (searchTerm === '') {
            displayClientsTable(clients);
            return;
        }

        const filtered = clients.filter(client =>
            (client.display_name && client.display_name.toLowerCase().includes(searchTerm)) ||
            (client.email && client.email.toLowerCase().includes(searchTerm)) ||
            (client.company_name && client.company_name.toLowerCase().includes(searchTerm)) ||
            (client.first_name && client.first_name.toLowerCase().includes(searchTerm)) ||
            (client.last_name && client.last_name.toLowerCase().includes(searchTerm))
        );

        displayClientsTable(filtered);
    }

    // Display clients table
    function displayClientsTable(clientsList) {
        const container = document.getElementById('clientsTableBody');
        container.innerHTML = '';

        if (clientsList.length === 0) {
            container.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center py-5">
                        <span class="material-icons" style="font-size: 3rem; color: #6c757d; margin-bottom: 1rem;">groups</span>
                        <h4 class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</h4>
                        <p class="text-muted">Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨Ø¯Ø¡</p>
                    </td>
                </tr>
            `;
            return;
        }

        clientsList.forEach(client => {
            const clientRow = createClientRow(client);
            container.appendChild(clientRow);
        });

        updateBulkActionsVisibility();
    }

    // Create client row - Ø¥ØµØ¯Ø§Ø± Ù…Ø­Ø³Ù† ÙˆÙ…ÙØµØ­Ø­
    function createClientRow(client) {
        const row = document.createElement('tr');

        // Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ
        const phoneActions = client.phone ? `
            <div class="phone-actions">
                <span class="phone-number">${client.phone}</span>
                <a href="tel:${client.phone}" class="btn btn-phone btn-call" title="Ù…ÙƒØ§Ù„Ù…Ø©">
                    <span class="material-icons">call</span>
                </a>
                <a href="https://wa.me/${client.phone.replace(/\s/g, '')}" target="_blank" class="btn btn-phone btn-whatsapp" title="ÙˆØ§ØªØ³Ø§Ø¨">
                    <span class="material-icons">message</span>
                </a>
            </div>
        ` : '<span class="text-muted">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>';

        // Ø¥Ù†Ø´Ø§Ø¡ HTML Ø¨Ø¯ÙˆÙ† onclick events
        row.innerHTML = `
            <td>
                <input type="checkbox" class="form-check-input client-checkbox" value="${client.id}">
            </td>
            <td>
                <div class="client-info">
                    <div class="client-avatar ${client.client_type === 'individual' ? 'avatar-individual' : 'avatar-company'}">
                        ${client.display_name ? client.display_name.charAt(0).toUpperCase() : 'C'}
                    </div>
                    <div class="client-details">
                        <h6>${client.display_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</h6>
                        <small>${client.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</small>
                    </div>
                </div>
            </td>
            <td>
                <span class="badge-type type-${client.client_type}">
                    ${client.client_type === 'individual' ? 'ÙØ±Ø¯' : 'Ø´Ø±ÙƒØ©'}
                </span>
            </td>
            <td>
                ${phoneActions}
            </td>
            <td>${client.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
            <td>
                <span class="badge-status ${getStatusClass(client.status)}">
                    ${getStatusText(client.status)}
                </span>
            </td>
            <td>${new Date(client.created_at).toLocaleDateString('ar-SA')}</td>
            <td>
                <div class="client-actions">
                    <button class="btn btn-action btn-view" data-client-id="${client.id}" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                        <span class="material-icons">visibility</span>
                    </button>
                    <button class="btn btn-action btn-edit" data-client-id="${client.id}" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                        <span class="material-icons">edit</span>
                    </button>
                    <button class="btn btn-action btn-delete" data-client-id="${client.id}" title="Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„">
                        <span class="material-icons">delete</span>
                    </button>
                </div>
            </td>
        `;

        // Ø¥Ø¶Ø§ÙØ© event listeners Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ HTML
        setTimeout(() => {
            // Ø²Ø± Ø§Ù„Ù€ checkbox
            const checkbox = row.querySelector('.client-checkbox');
            if (checkbox) {
                checkbox.addEventListener('change', updateBulkActions);
            }

            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
            const viewBtn = row.querySelector('.btn-view');
            const editBtn = row.querySelector('.btn-edit');
            const deleteBtn = row.querySelector('.btn-delete');

            if (viewBtn) {
                viewBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    console.log('ğŸ” Ø²Ø± Ø§Ù„Ø¹Ø±Ø¶ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡ Ù„Ø¹Ù…ÙŠÙ„:', client.id);
                    viewClient(client.id);
                });
            }

            if (editBtn) {
                editBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    console.log('âœï¸ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡ Ù„Ø¹Ù…ÙŠÙ„:', client.id);
                    editClient(client.id);
                });
            }

            if (deleteBtn) {
                deleteBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    console.log('ğŸ—‘ï¸ Ø²Ø± Ø§Ù„Ø­Ø°Ù ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡ Ù„Ø¹Ù…ÙŠÙ„:', client.id);
                    deleteClient(client.id);
                });
            }
        }, 10);

        return row;
    }

    // Get client subtitle based on type
    function getClientSubtitle(client) {
        if (client.client_type === 'individual') {
            return client.gender ? `${client.gender === 'male' ? 'Ø°ÙƒØ±' : 'Ø£Ù†Ø«Ù‰'}` : 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ';
        } else {
            return client.industry || 'Ø´Ø±ÙƒØ©';
        }
    }

    // Get status class
    function getStatusClass(status) {
        const classes = {
            'active': 'status-active',
            'inactive': 'status-inactive',
            'potential': 'status-potential',
            'targeted': 'status-targeted'
        };
        return classes[status] || 'status-inactive';
    }

    // Get status text
    function getStatusText(status) {
        const texts = {
            'active': 'Ù†Ø´Ø·',
            'inactive': 'ØºÙŠØ± Ù†Ø´Ø·',
            'potential': 'Ù…Ø­ØªÙ…Ù„',
            'targeted': 'Ø³ÙŠØªÙ… Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙ‡'
        };
        return texts[status] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    }

    // Add new client - Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© global
    window.addClient = async function () {
        const saveBtn = document.getElementById('saveClientBtn');
        const saveText = document.getElementById('saveClientText');
        const saveSpinner = document.getElementById('saveClientSpinner');

        try {
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            saveBtn.disabled = true;
            saveText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
            saveSpinner.style.display = 'inline-block';

            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const clientType = document.getElementById('clientType').value;
            const email = document.getElementById('email').value.trim();

            if (!email) {
                alert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨');
                return;
            }

            let formData = {
                client_type: clientType,
                email: email,
                phone: document.getElementById('phone').value.trim(),
                city: document.getElementById('city').value.trim(),
                country: document.getElementById('country').value.trim(),
                status: document.getElementById('status').value,
                priority: document.getElementById('priority').value,
                source: document.getElementById('source').value,
                notes: document.getElementById('notes').value.trim()
            };

            if (clientType === 'individual') {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();

                console.log(`ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±Ø¯: ${firstName} ${lastName}`);

                if (!firstName || !lastName) {
                    console.log('âŒ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø£Ø®ÙŠØ± Ù…ÙÙ‚ÙˆØ¯');
                    alert('Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø£Ø®ÙŠØ± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†');
                    return;
                }

                formData.first_name = firstName;
                formData.last_name = lastName;
                formData.national_id = document.getElementById('nationalId').value.trim();
                formData.gender = document.getElementById('gender').value;
                formData.date_of_birth = document.getElementById('dateOfBirth').value;
            } else {
                const companyName = document.getElementById('companyName').value.trim();

                console.log(`ğŸ¢ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©: ${companyName}`);

                if (!companyName) {
                    console.log('âŒ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© Ù…ÙÙ‚ÙˆØ¯');
                    alert('Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© Ù…Ø·Ù„ÙˆØ¨');
                    return;
                }

                formData.company_name = companyName;
                formData.industry = document.getElementById('industry').value;
                formData.tax_number = document.getElementById('taxNumber').value.trim();
                formData.registration_number = document.getElementById('registrationNumber').value.trim();
            }

            console.log('ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', formData);

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
            const response = await fetch('/api/v1/clients/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify(formData)
            });

            console.log(`ğŸ“¨ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ${response.status} - ${response.statusText}`);

            const result = await response.json();
            console.log('ğŸ“‹ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', result);

            if (response.status === 201 && result.success) {
                // Ù†Ø¬Ø­Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                const modal = bootstrap.Modal.getInstance(document.getElementById('addClientModal'));
                if (modal) {
                    console.log('ğŸšª Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©');
                    modal.hide();
                }

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                loadClients();
                loadClientStatistics();

                // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('addClientForm').reset();
                document.getElementById('country').value = 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
                document.getElementById('status').value = 'active';
                document.getElementById('priority').value = 'medium';

            } else {
                // ÙØ´Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                console.log('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„:', result.message);
                alert(`âŒ ${result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„'}`);
            }

        } catch (error) {
            console.error('ğŸ’¥ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
        } finally {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
            saveBtn.disabled = false;
            saveText.textContent = 'Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„';
            saveSpinner.style.display = 'none';
            console.log('ğŸ”“ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±');
        }
    }

    // View client details - ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ¸ÙŠÙØ©
    window.viewClient = function (clientId) {
        console.log('ğŸ” Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„:', clientId);

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        const client = clients.find(c => c.id == clientId) || allClients.find(c => c.id == clientId);

        if (!client) {
            console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„:', clientId);
            showAlert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'danger');
            return;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
        const detailsModal = document.createElement('div');
        detailsModal.className = 'modal fade';
        detailsModal.id = 'clientDetailsModal';
        detailsModal.innerHTML = `
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="border-radius: 16px;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 16px 16px 0 0;">
                        <h5 class="modal-title">
                            <span class="material-icons me-2">person</span>
                            ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="row">
                            <div class="col-md-4 text-center mb-4">
                                <div class="client-avatar ${client.client_type === 'individual' ? 'avatar-individual' : 'avatar-company'}" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto;">
                                    ${client.display_name ? client.display_name.charAt(0).toUpperCase() : 'C'}
                                </div>
                                <h4 class="mt-3">${client.display_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</h4>
                                <p class="text-muted">${client.client_type === 'individual' ? 'Ø¹Ù…ÙŠÙ„ ÙØ±Ø¯ÙŠ' : 'Ø´Ø±ÙƒØ©'}</p>
                            </div>
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong>
                                        <p class="text-muted">${client.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong>
                                        <p class="text-muted">${client.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong>
                                        <p class="text-muted">${client.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong>
                                        <span class="badge-status ${getStatusClass(client.status)}">
                                            ${getStatusText(client.status)}
                                        </span>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</strong>
                                        <p class="text-muted">${new Date(client.created_at).toLocaleDateString('ar-SA')}</p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <strong>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</strong>
                                        <p class="text-muted">${client.priority || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                        <button type="button" class="btn btn-gradient" onclick="editClient(${clientId})">
                            <span class="material-icons me-2">edit</span>
                            ØªØ¹Ø¯ÙŠÙ„
                        </button>
                    </div>
                </div>
            </div>
        `;

        document.body.appendChild(detailsModal);
        const modal = new bootstrap.Modal(detailsModal);
        modal.show();

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
        detailsModal.addEventListener('hidden.bs.modal', function () {
            document.body.removeChild(detailsModal);
        });
    }

    // Edit client - ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ¸ÙŠÙØ©
    window.editClient = function (clientId) {
        console.log('âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„:', clientId);

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        const client = clients.find(c => c.id == clientId) || allClients.find(c => c.id == clientId);

        if (!client) {
            console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:', clientId);
            showAlert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„', 'danger');
            return;
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
        const detailsModal = document.getElementById('clientDetailsModal');
        if (detailsModal) {
            bootstrap.Modal.getInstance(detailsModal).hide();
        }

        // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
        document.getElementById('clientType').value = client.client_type;
        document.getElementById('email').value = client.email || '';
        document.getElementById('phone').value = client.phone || '';
        document.getElementById('city').value = client.city || '';
        document.getElementById('country').value = client.country || 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
        document.getElementById('status').value = client.status || 'active';
        document.getElementById('priority').value = client.priority || 'medium';
        document.getElementById('source').value = client.source || '';
        document.getElementById('notes').value = client.notes || '';

        // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
        if (client.client_type === 'individual') {
            document.getElementById('firstName').value = client.first_name || '';
            document.getElementById('lastName').value = client.last_name || '';
            document.getElementById('nationalId').value = client.national_id || '';
            document.getElementById('gender').value = client.gender || '';
            document.getElementById('dateOfBirth').value = client.date_of_birth || '';
            selectClientType('individual');
        } else {
            document.getElementById('companyName').value = client.company_name || '';
            document.getElementById('industry').value = client.industry || '';
            document.getElementById('taxNumber').value = client.tax_number || '';
            document.getElementById('registrationNumber').value = client.registration_number || '';
            selectClientType('company');
        }

        // ØªØºÙŠÙŠØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.querySelector('#addClientModal .modal-title').innerHTML = `
            <span class="material-icons me-2">edit</span>
            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„
        `;

        // ØªØºÙŠÙŠØ± Ø²Ø± Ø§Ù„Ø­ÙØ¸
        const saveBtn = document.getElementById('saveClientBtn');
        saveBtn.onclick = () => updateClient(clientId);
        document.getElementById('saveClientText').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';

        // ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const modal = new bootstrap.Modal(document.getElementById('addClientModal'));
        modal.show();
    }

    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© ÙˆØ¸ÙŠÙØ© deleteClient Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© - Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªØªÙˆÙ„Ù‰ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©

    // Update client - ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«
    async function updateClient(clientId) {
        console.log('ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„:', clientId);

        const saveBtn = document.getElementById('saveClientBtn');
        const saveText = document.getElementById('saveClientText');
        const saveSpinner = document.getElementById('saveClientSpinner');

        try {
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            saveBtn.disabled = true;
            saveText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
            saveSpinner.style.display = 'inline-block';

            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const clientType = document.getElementById('clientType').value;
            const email = document.getElementById('email').value.trim();

            if (!email) {
                showAlert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø·Ù„ÙˆØ¨', 'danger');
                return;
            }

            let formData = {
                client_type: clientType,
                email: email,
                phone: document.getElementById('phone').value.trim(),
                city: document.getElementById('city').value.trim(),
                country: document.getElementById('country').value.trim(),
                status: document.getElementById('status').value,
                priority: document.getElementById('priority').value,
                source: document.getElementById('source').value,
                notes: document.getElementById('notes').value.trim()
            };

            if (clientType === 'individual') {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();

                if (!firstName || !lastName) {
                    showAlert('Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø£Ø®ÙŠØ± Ù…Ø·Ù„ÙˆØ¨Ø§Ù†', 'danger');
                    return;
                }

                formData.first_name = firstName;
                formData.last_name = lastName;
                formData.national_id = document.getElementById('nationalId').value.trim();
                formData.gender = document.getElementById('gender').value;
                formData.date_of_birth = document.getElementById('dateOfBirth').value;
            } else {
                const companyName = document.getElementById('companyName').value.trim();

                if (!companyName) {
                    showAlert('Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© Ù…Ø·Ù„ÙˆØ¨', 'danger');
                    return;
                }

                formData.company_name = companyName;
                formData.industry = document.getElementById('industry').value;
                formData.tax_number = document.getElementById('taxNumber').value.trim();
                formData.registration_number = document.getElementById('registrationNumber').value.trim();
            }

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
            const response = await fetch(`/api/v1/clients/${clientId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();

            if (response.ok && result.success) {
                showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const modal = bootstrap.Modal.getInstance(document.getElementById('addClientModal'));
                modal.hide();

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                loadClients();
                loadClientStatistics();

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                resetClientForm();
            } else {
                showAlert(result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„', 'danger');
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„:', error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'danger');
        } finally {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
            saveBtn.disabled = false;
            saveText.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
            saveSpinner.style.display = 'none';
        }
    }

    // Reset client form - ÙˆØ¸ÙŠÙØ© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function resetClientForm() {
        document.getElementById('addClientForm').reset();
        document.querySelector('#addClientModal .modal-title').innerHTML = `
            <span class="material-icons me-2">person_add</span>
            Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
        `;
        document.getElementById('saveClientBtn').onclick = addClient;
        document.getElementById('saveClientText').textContent = 'Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„';
        document.getElementById('country').value = 'Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©';
        document.getElementById('status').value = 'active';
        document.getElementById('priority').value = 'medium';
        selectClientType('company');
    }

    // Toggle select all
    window.toggleSelectAll = function () {
        const selectAllCheckbox = document.getElementById('selectAll');
        const clientCheckboxes = document.querySelectorAll('.client-checkbox');

        clientCheckboxes.forEach(checkbox => {
            checkbox.checked = selectAllCheckbox.checked;
        });

        updateBulkActions();
    }

    // Update bulk actions visibility
    function updateBulkActions() {
        const selectedCheckboxes = document.querySelectorAll('.client-checkbox:checked');
        const bulkActions = document.getElementById('bulkActions');
        const selectedCount = document.getElementById('selectedCount');

        if (selectedCheckboxes.length > 0) {
            bulkActions.classList.add('show');
            selectedCount.textContent = selectedCheckboxes.length;
        } else {
            bulkActions.classList.remove('show');
        }

        // Update select all checkbox state
        const allCheckboxes = document.querySelectorAll('.client-checkbox');
        const selectAllCheckbox = document.getElementById('selectAll');

        if (selectedCheckboxes.length === 0) {
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.checked = false;
        } else if (selectedCheckboxes.length === allCheckboxes.length) {
            selectAllCheckbox.indeterminate = false;
            selectAllCheckbox.checked = true;
        } else {
            selectAllCheckbox.indeterminate = true;
        }
    }

    function updateBulkActionsVisibility() {
        updateBulkActions();
    }

    // Bulk update status - Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© global
    window.bulkUpdateStatus = async function (status) {
        const selectedCheckboxes = document.querySelectorAll('.client-checkbox:checked');
        const clientIds = Array.from(selectedCheckboxes).map(cb => cb.value);

        if (clientIds.length === 0) {
            showAlert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„ØªØ­Ø¯ÙŠØ«', 'warning');
            return;
        }

        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ${clientIds.length} Ø¹Ù…ÙŠÙ„ØŸ`)) {
            return;
        }

        try {
            const response = await fetch('/api/v1/clients/bulk-update', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify({
                    client_ids: clientIds,
                    status: status
                })
            });

            const result = await response.json();

            if (response.ok && result.success) {
                showAlert(`ØªÙ… ØªØ­Ø¯ÙŠØ« ${clientIds.length} Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                loadClients();
                loadClientStatistics();
                updateBulkActions();
            } else {
                showAlert(result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…Ø¹', 'danger');
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…Ø¹:', error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'danger');
        }
    }

    // Bulk delete - Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© global
    window.bulkDelete = async function () {
        const selectedCheckboxes = document.querySelectorAll('.client-checkbox:checked');
        const clientIds = Array.from(selectedCheckboxes).map(cb => cb.value);

        if (clientIds.length === 0) {
            showAlert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„Ø­Ø°Ù', 'warning');
            return;
        }

        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${clientIds.length} Ø¹Ù…ÙŠÙ„ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`)) {
            return;
        }

        try {
            const response = await fetch('/api/v1/clients/bulk-delete', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify({
                    client_ids: clientIds
                })
            });

            const result = await response.json();

            if (response.ok && result.success) {
                showAlert(`ØªÙ… Ø­Ø°Ù ${clientIds.length} Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                loadClients();
                loadClientStatistics();
                updateBulkActions();
            } else {
                showAlert(result.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…Ø¹', 'danger');
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…Ø¹:', error);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'danger');
        }
    }

    // Export clients - Ø¬Ø¹Ù„ Ø§Ù„ÙˆØ¸ÙŠÙØ© global
    window.exportClients = function () {
        const statusFilter = document.getElementById('filterStatus').value;
        const typeFilter = document.getElementById('filterType').value;

        let queryParams = new URLSearchParams();
        if (statusFilter) queryParams.append('status', statusFilter);
        if (typeFilter) queryParams.append('type', typeFilter);

        const url = `/api/v1/reports/export/excel`;

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
            },
            body: JSON.stringify({
                export_type: 'clients',
                filters: {
                    status: statusFilter,
                    type: typeFilter
                }
            })
        })
            .then(response => {
                if (response.ok) {
                    return response.blob();
                }
                throw new Error('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `clients_${new Date().toISOString().split('T')[0]}.xlsx`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            })
            .catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'danger');
            });
    }

    // Show alert
    function showAlert(message, type) {
        console.log(`ğŸ”” Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ [${type}]:`, message);

        // Remove any existing alerts first
        const existingAlerts = document.querySelectorAll('.alert');
        existingAlerts.forEach(alert => {
            if (alert.parentNode) {
                alert.parentNode.removeChild(alert);
            }
        });

        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed top-0 end-0 m-3`;
        alertDiv.style.zIndex = '9999';
        alertDiv.style.maxWidth = '400px';
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        document.body.appendChild(alertDiv);
        console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©');

        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.parentNode.removeChild(alertDiv);
                console.log('ğŸ—‘ï¸ ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡');
            }
        }, 5000);
    }
</script>
{% endblock %}